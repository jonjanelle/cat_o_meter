<div class="rating-box selection-box">
  <h3 class="text-center text-xl text-shadow-light color-purple">RATING</h3>
  <hr>
  <div class='rating-stars text-center'>
    <ul id='stars'>
      <li class='star' title='1/10' data-value='1'>
        <i class='fa fa-star fa-fw'></i>
      </li>
      <li class='star' title='2/10' data-value='2'>
        <i class='fa fa-star fa-fw'></i>
      </li>
      <li class='star' title='3/10' data-value='3'>
        <i class='fa fa-star fa-fw'></i>
      </li>
      <li class='star' title='4/10' data-value='4'>
        <i class='fa fa-star fa-fw'></i>
      </li>
      <li class='star' title='5/10' data-value='5'>
        <i class='fa fa-star fa-fw'></i>
      </li>
      <li class='star' title='6/10' data-value='6'>
        <i class='fa fa-star fa-fw'></i>
      </li>
      <li class='star' title='7/10' data-value='7'>
        <i class='fa fa-star fa-fw'></i>
      </li>
      <li class='star' title='8/10' data-value='8'>
        <i class='fa fa-star fa-fw'></i>
      </li>
      <li class='star' title='9/10' data-value='9'>
        <i class='fa fa-star fa-fw'></i>
      </li>
      <li class='star' title='10/10' data-value='10'>
        <i class='fa fa-star fa-fw'></i>
      </li>
    </ul>
    <% if @user.present? %>
      <button class="btn btn-primary">Submit Rating</button>
    <% else %>
      <%= form_tag "" do %>
        <%= link_to new_user_session_path, class: "btn btn-primary" do %>
          <i class="fa fa-lock"></i>  Sign-in to vote!
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>

<% content_for :javascript  do %>
  <script>
    $(document).ready(function () {
      $(".star").tooltip();
      $('#stars li').on('mouseover', function () {
        var onStar = parseInt($(this).data('value'), 10); // The star currently mouse on

        // Now highlight all the stars that's not after the current hovered star
        $(this).parent().children('li.star').each(function (e) {
          if (e < onStar) {
            $(this).addClass('hover');
          } else {
            $(this).removeClass('hover');
          }
        });

      }).on('mouseout', function () {
        $(this).parent().children('li.star').each(function (e) {
          $(this).removeClass('hover');
        });
      });

      $('#stars li').on('click', function () {
        var onStar = parseInt($(this).data('value'), 10); // The star currently selected
        var stars = $(this).parent().children('li.star');

        for (i = 0; i < stars.length; i++) {
          $(stars[i]).removeClass('selected');
        }

        for (i = 0; i < onStar; i++) {
          $(stars[i]).addClass('selected');
        }

        var ratingValue = parseInt($('#stars li.selected').last().data('value'), 10);
        var msg = "";
        console.log(ratingValue);
        if (ratingValue > 0) {
          msg = "Thanks! You rated this cat " + ratingValue + " stars.";
        }
        responseMessage(msg);

      });

    });
  </script>
<% end %>
